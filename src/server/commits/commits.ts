import type { Weekday } from "../../config.js";

export const commits = {
  total_count: 26795,
  incomplete_results: false,
  items: [
    {
      url: "https://api.github.com/repos/remotion-dev/remotion/commits/eeb2cdb8509d85a7f5af3a69e4348ff9cb83ee18",
      sha: "eeb2cdb8509d85a7f5af3a69e4348ff9cb83ee18",
      node_id:
        "MDY6Q29tbWl0Mjc0NDk1NDI1OmVlYjJjZGI4NTA5ZDg1YTdmNWFmM2E2OWU0MzQ4ZmY5Y2I4M2VlMTg=",
      html_url:
        "https://github.com/remotion-dev/remotion/commit/eeb2cdb8509d85a7f5af3a69e4348ff9cb83ee18",
      comments_url:
        "https://api.github.com/repos/remotion-dev/remotion/commits/eeb2cdb8509d85a7f5af3a69e4348ff9cb83ee18/comments",
      commit: {
        url: "https://api.github.com/repos/remotion-dev/remotion/git/commits/eeb2cdb8509d85a7f5af3a69e4348ff9cb83ee18",
        author: {
          date: "2023-11-28T10:06:03.000+01:00",
          name: "Jonny Burger",
          email: "jonathanburger11@gmail.com",
        },
        committer: {
          date: "2023-11-28T10:06:03.000+01:00",
          name: "Jonny Burger",
          email: "jonathanburger11@gmail.com",
        },
        message:
          "`remotion`: Re-introduce validation for metadata specified without calculateMetdata()",
        tree: {
          url: "https://api.github.com/repos/remotion-dev/remotion/git/trees/965f7961cae7219587fca17a20de81ae48069000",
          sha: "965f7961cae7219587fca17a20de81ae48069000",
        },
        comment_count: 0,
      },
      author: {
        login: "JonnyBurger",
        id: 1629785,
        node_id: "MDQ6VXNlcjE2Mjk3ODU=",
        avatar_url: "https://avatars.githubusercontent.com/u/1629785?v=4",
        gravatar_id: "",
        url: "https://api.github.com/users/JonnyBurger",
        html_url: "https://github.com/JonnyBurger",
        followers_url: "https://api.github.com/users/JonnyBurger/followers",
        following_url:
          "https://api.github.com/users/JonnyBurger/following{/other_user}",
        gists_url: "https://api.github.com/users/JonnyBurger/gists{/gist_id}",
        starred_url:
          "https://api.github.com/users/JonnyBurger/starred{/owner}{/repo}",
        subscriptions_url:
          "https://api.github.com/users/JonnyBurger/subscriptions",
        organizations_url: "https://api.github.com/users/JonnyBurger/orgs",
        repos_url: "https://api.github.com/users/JonnyBurger/repos",
        events_url: "https://api.github.com/users/JonnyBurger/events{/privacy}",
        received_events_url:
          "https://api.github.com/users/JonnyBurger/received_events",
        type: "User",
        site_admin: false,
      },
      committer: {
        login: "JonnyBurger",
        id: 1629785,
        node_id: "MDQ6VXNlcjE2Mjk3ODU=",
        avatar_url: "https://avatars.githubusercontent.com/u/1629785?v=4",
        gravatar_id: "",
        url: "https://api.github.com/users/JonnyBurger",
        html_url: "https://github.com/JonnyBurger",
        followers_url: "https://api.github.com/users/JonnyBurger/followers",
        following_url:
          "https://api.github.com/users/JonnyBurger/following{/other_user}",
        gists_url: "https://api.github.com/users/JonnyBurger/gists{/gist_id}",
        starred_url:
          "https://api.github.com/users/JonnyBurger/starred{/owner}{/repo}",
        subscriptions_url:
          "https://api.github.com/users/JonnyBurger/subscriptions",
        organizations_url: "https://api.github.com/users/JonnyBurger/orgs",
        repos_url: "https://api.github.com/users/JonnyBurger/repos",
        events_url: "https://api.github.com/users/JonnyBurger/events{/privacy}",
        received_events_url:
          "https://api.github.com/users/JonnyBurger/received_events",
        type: "User",
        site_admin: false,
      },
      parents: [
        {
          url: "https://api.github.com/repos/remotion-dev/remotion/commits/6823da4691e43864a3696df3a6fbe529cc73bb71",
          html_url:
            "https://github.com/remotion-dev/remotion/commit/6823da4691e43864a3696df3a6fbe529cc73bb71",
          sha: "6823da4691e43864a3696df3a6fbe529cc73bb71",
        },
      ],
      repository: {
        id: 274495425,
        node_id: "MDEwOlJlcG9zaXRvcnkyNzQ0OTU0MjU=",
        name: "remotion",
        full_name: "remotion-dev/remotion",
        private: false,
        owner: {
          login: "remotion-dev",
          id: 85344006,
          node_id: "MDEyOk9yZ2FuaXphdGlvbjg1MzQ0MDA2",
          avatar_url: "https://avatars.githubusercontent.com/u/85344006?v=4",
          gravatar_id: "",
          url: "https://api.github.com/users/remotion-dev",
          html_url: "https://github.com/remotion-dev",
          followers_url: "https://api.github.com/users/remotion-dev/followers",
          following_url:
            "https://api.github.com/users/remotion-dev/following{/other_user}",
          gists_url:
            "https://api.github.com/users/remotion-dev/gists{/gist_id}",
          starred_url:
            "https://api.github.com/users/remotion-dev/starred{/owner}{/repo}",
          subscriptions_url:
            "https://api.github.com/users/remotion-dev/subscriptions",
          organizations_url: "https://api.github.com/users/remotion-dev/orgs",
          repos_url: "https://api.github.com/users/remotion-dev/repos",
          events_url:
            "https://api.github.com/users/remotion-dev/events{/privacy}",
          received_events_url:
            "https://api.github.com/users/remotion-dev/received_events",
          type: "Organization",
          site_admin: false,
        },
        html_url: "https://github.com/remotion-dev/remotion",
        description: "ðŸŽ¥      Make videos programmatically with React",
        fork: false,
        url: "https://api.github.com/repos/remotion-dev/remotion",
        forks_url: "https://api.github.com/repos/remotion-dev/remotion/forks",
        keys_url:
          "https://api.github.com/repos/remotion-dev/remotion/keys{/key_id}",
        collaborators_url:
          "https://api.github.com/repos/remotion-dev/remotion/collaborators{/collaborator}",
        teams_url: "https://api.github.com/repos/remotion-dev/remotion/teams",
        hooks_url: "https://api.github.com/repos/remotion-dev/remotion/hooks",
        issue_events_url:
          "https://api.github.com/repos/remotion-dev/remotion/issues/events{/number}",
        events_url: "https://api.github.com/repos/remotion-dev/remotion/events",
        assignees_url:
          "https://api.github.com/repos/remotion-dev/remotion/assignees{/user}",
        branches_url:
          "https://api.github.com/repos/remotion-dev/remotion/branches{/branch}",
        tags_url: "https://api.github.com/repos/remotion-dev/remotion/tags",
        blobs_url:
          "https://api.github.com/repos/remotion-dev/remotion/git/blobs{/sha}",
        git_tags_url:
          "https://api.github.com/repos/remotion-dev/remotion/git/tags{/sha}",
        git_refs_url:
          "https://api.github.com/repos/remotion-dev/remotion/git/refs{/sha}",
        trees_url:
          "https://api.github.com/repos/remotion-dev/remotion/git/trees{/sha}",
        statuses_url:
          "https://api.github.com/repos/remotion-dev/remotion/statuses/{sha}",
        languages_url:
          "https://api.github.com/repos/remotion-dev/remotion/languages",
        stargazers_url:
          "https://api.github.com/repos/remotion-dev/remotion/stargazers",
        contributors_url:
          "https://api.github.com/repos/remotion-dev/remotion/contributors",
        subscribers_url:
          "https://api.github.com/repos/remotion-dev/remotion/subscribers",
        subscription_url:
          "https://api.github.com/repos/remotion-dev/remotion/subscription",
        commits_url:
          "https://api.github.com/repos/remotion-dev/remotion/commits{/sha}",
        git_commits_url:
          "https://api.github.com/repos/remotion-dev/remotion/git/commits{/sha}",
        comments_url:
          "https://api.github.com/repos/remotion-dev/remotion/comments{/number}",
        issue_comment_url:
          "https://api.github.com/repos/remotion-dev/remotion/issues/comments{/number}",
        contents_url:
          "https://api.github.com/repos/remotion-dev/remotion/contents/{+path}",
        compare_url:
          "https://api.github.com/repos/remotion-dev/remotion/compare/{base}...{head}",
        merges_url: "https://api.github.com/repos/remotion-dev/remotion/merges",
        archive_url:
          "https://api.github.com/repos/remotion-dev/remotion/{archive_format}{/ref}",
        downloads_url:
          "https://api.github.com/repos/remotion-dev/remotion/downloads",
        issues_url:
          "https://api.github.com/repos/remotion-dev/remotion/issues{/number}",
        pulls_url:
          "https://api.github.com/repos/remotion-dev/remotion/pulls{/number}",
        milestones_url:
          "https://api.github.com/repos/remotion-dev/remotion/milestones{/number}",
        notifications_url:
          "https://api.github.com/repos/remotion-dev/remotion/notifications{?since,all,participating}",
        labels_url:
          "https://api.github.com/repos/remotion-dev/remotion/labels{/name}",
        releases_url:
          "https://api.github.com/repos/remotion-dev/remotion/releases{/id}",
        deployments_url:
          "https://api.github.com/repos/remotion-dev/remotion/deployments",
      },
      score: 1.0,
    },
  ],
};

export type Commit = {
  message: string;
  author: string;
  repo: string;
  date: number;
  hour: number;
  fork: boolean;
};

const remapWeekdays = (weekday: number): Weekday => {
  if (weekday === 0) {
    return "6";
  }

  if (weekday === 1) {
    return "0";
  }

  if (weekday === 2) {
    return "1";
  }

  if (weekday === 3) {
    return "2";
  }

  if (weekday === 4) {
    return "3";
  }

  if (weekday === 5) {
    return "4";
  }

  if (weekday === 6) {
    return "5";
  }

  throw new Error("unknown weekday" + weekday);
};

type Weekdays = {
  least: Weekday;
  leastCount: number;
  mostCount: number;
  most: Weekday;
  ratio: number;
  days: number[];
};

export const getMostProductive = (response: Commit[]): Weekdays => {
  const weekdays: { [key in Weekday]: number } = {
    0: 0,
    1: 0,
    2: 0,
    3: 0,
    4: 0,
    5: 0,
    6: 0,
  };
  for (const r of response) {
    const date = new Date(r.date);
    const day = date.getDay();
    const europeanDay = remapWeekdays(day);
    weekdays[europeanDay] += 1;
  }

  const entries = Object.entries(weekdays) as [Weekday, number][];

  const sortedDays = entries.slice().sort((a, b) => a[1] - b[1]);

  const [leastDay, leastAmount] = sortedDays[0];
  const [mostDay, mostAmount] = sortedDays[sortedDays.length - 1];

  const ratio = Math.max(mostAmount, 1) / Math.max(leastAmount, 1);

  return {
    least: leastDay,
    most: mostDay,
    ratio,
    leastCount: leastAmount,
    mostCount: mostAmount,
    days: Object.values(weekdays),
  };
};
